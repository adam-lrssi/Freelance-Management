{% extends "base.html" %}

{% block title %}Chat{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">
                    Utilisateurs en ligne
                </div>
                <ul class="list-group list-group-flush" id="users-list">
                </ul>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card shadow-sm d-flex flex-column h-100">
                <div class="card-header bg-primary text-white">
                    Chat en direct
                </div>
                <div class="card-body chat-messages" style="overflow-y: scroll;">
                    <ul class="list-unstyled" id="messages-list">
                        </ul>
                </div>
                <div class="card-footer">
                    <form id="message-form" class="d-flex">
                        <input type="text" id="message-input" class="form-control me-2" placeholder="Ã‰crivez votre message..." autocomplete="off">
                        <button type="submit" class="btn btn-primary">Envoyer</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Custom CSS to make the chat panel fill the space */
    html, body {
        height: 100%;
    }
    .container-fluid, .row, .col-md-8, .card {
        height: 100%;
    }
    .chat-messages {
        flex-grow: 1;
        height: 400px; /* Adjust as needed */
    }
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        var messagesList = document.getElementById('messages-list');
        var usersList = document.getElementById('users-list');

        // GÃ¨re l'Ã©vÃ©nement 'new_message'
        socket.on('new_message', function(data) {
            var listItem = document.createElement('li');
            listItem.textContent = data.user + ' : ' + data.message;
            messagesList.appendChild(listItem);
        });

        // ðŸ’¡ GÃ¨re le nouvel Ã©vÃ©nement 'update_users'
        socket.on('update_users', function(data) {
            usersList.innerHTML = ''; // Efface la liste
            data.user_list.forEach(function(username) {
                var listItem = document.createElement('li');
                listItem.className = 'list-group-item';
                listItem.textContent = username;
                usersList.appendChild(listItem);
            });
        });

        // GÃ¨re l'envoi du formulaire
        document.getElementById('message-form').onsubmit = function(e) {
            e.preventDefault();
            var input = document.getElementById('message-input');
            var message = input.value;
            
            if (message) {
                socket.emit('message', { 'message': message });
                input.value = '';
            }
        };
    });
</script>

{% endblock %}